<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Panel Administrativo - Sistema de Gestión de Choferes">
    <meta name="author" content="Sistema de Administración">

    <title>{% block title %}Panel Administrativo{% endblock %}</title>

    <!-- Preconnect para mejor performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Bootstrap 5 + Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
      /* ===== CSS Variables ===== */
      :root {
        /* Colors */
        --primary-color: #6366f1;
        --primary-dark: #4f46e5;
        --secondary-color: #64748b;
        --accent-color: #06b6d4;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;

        /* Light Theme */
        --bg-primary: #f8fafc;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f1f5f9;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --text-muted: #94a3b8;
        --border-color: #e2e8f0;
        --border-light: #f1f5f9;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);

        /* Transitions */
        --transition-fast: 0.15s ease;
        --transition-normal: 0.3s ease;
        --transition-slow: 0.5s ease;

        /* Spacing */
        --spacing-xs: 0.25rem;
        --spacing-sm: 0.5rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-2xl: 3rem;

        /* Border radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
      }

      /* Dark Theme */
      [data-theme="dark"] {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-tertiary: #334155;
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-color: #334155;
        --border-light: #475569;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
      }

      /* ===== Reset & Base ===== */
      * {
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 0.875rem;
        line-height: 1.5;
        color: var(--text-primary);
        background: var(--bg-primary);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* ===== Layout ===== */
      .app-layout {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: 280px;
        background: var(--bg-secondary);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform var(--transition-normal);
        box-shadow: var(--shadow-lg);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .sidebar-header {
        padding: var(--spacing-xl);
        border-bottom: 1px solid var(--border-color);
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
      }

      .sidebar-header h4 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .sidebar-nav {
        flex: 1;
        padding: var(--spacing-md) 0;
        overflow-y: auto;
      }

      .nav-item {
        margin: 0 var(--spacing-sm);
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: var(--spacing-md);
        color: var(--text-secondary);
        text-decoration: none;
        border-radius: var(--radius-md);
        transition: all var(--transition-fast);
        position: relative;
        font-weight: 500;
        margin-bottom: var(--spacing-xs);
      }

      .nav-link:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        transform: translateX(4px);
      }

      .nav-link.active {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        box-shadow: var(--shadow-md);
      }

      .nav-link i {
        margin-right: var(--spacing-md);
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
      }

      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-left: 0;
        transition: margin-left var(--transition-normal);
      }

      .topbar {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        padding: var(--spacing-md) var(--spacing-xl);
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 50;
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-sm);
      }

      .topbar-left {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
      }

      .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 1.25rem;
        padding: var(--spacing-sm);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: background var(--transition-fast);
      }

      .mobile-menu-btn:hover {
        background: var(--bg-tertiary);
      }

      .topbar-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
      }

      .topbar-right {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
      }

      .theme-toggle {
        background: none;
        border: 2px solid var(--border-color);
        border-radius: 50%;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition-fast);
        color: var(--text-primary);
      }

      .theme-toggle:hover {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        transform: scale(1.05);
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        color: var(--text-secondary);
        font-weight: 500;
      }

      .user-avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 1.1rem;
      }

      .user-name {
        font-size: 0.875rem;
      }

      .main-area {
        flex: 1;
        padding: var(--spacing-xl);
        overflow-y: auto;
      }

      /* ===== Components ===== */
      .card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-fast);
        overflow: hidden;
      }

      .card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
      }

      .card-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border-color);
        background: var(--bg-tertiary);
        font-weight: 600;
        color: var(--text-primary);
      }

      .card-body {
        padding: var(--spacing-lg);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-lg);
        border-radius: var(--radius-md);
        font-weight: 500;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all var(--transition-fast);
        font-size: 0.875rem;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-outline-secondary {
        background: transparent;
        border: 2px solid var(--border-color);
        color: var(--text-primary);
      }

      .btn-outline-secondary:hover {
        background: var(--bg-tertiary);
        border-color: var(--text-secondary);
      }

      .form-control, .form-select {
        width: 100%;
        padding: var(--spacing-md);
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        background: var(--bg-secondary);
        color: var(--text-primary);
        font-size: 0.875rem;
        transition: all var(--transition-fast);
      }

      .form-control:focus, .form-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .form-label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.875rem;
      }

      /* ===== Utilities ===== */
      .alert {
        padding: var(--spacing-lg);
        border-radius: var(--radius-md);
        border: none;
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-md);
      }

      .alert-success {
        background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        color: #065f46;
        border-left: 4px solid var(--success-color);
      }

      .alert-danger {
        background: linear-gradient(135deg, #fef2f2, #fecaca);
        color: #991b1b;
        border-left: 4px solid var(--danger-color);
      }

      .alert-warning {
        background: linear-gradient(135deg, #fffbeb, #fef3c7);
        color: #92400e;
        border-left: 4px solid var(--warning-color);
      }

      .alert-info {
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        color: #1e40af;
        border-left: 4px solid var(--accent-color);
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      [data-theme="dark"] .loading-overlay {
        background: rgba(15, 23, 42, 0.9);
      }

      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        z-index: 99;
        opacity: 0;
        visibility: hidden;
        transition: all var(--transition-normal);
      }

      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      /* ===== Responsive Design ===== */
      @media (min-width: 1024px) {
        .sidebar {
          position: static;
          transform: none;
        }

        .main-content {
          margin-left: 0;
        }

        .mobile-menu-btn {
          display: none;
        }

        .sidebar-overlay {
          display: none;
        }
      }

      @media (max-width: 1023px) {
        .mobile-menu-btn {
          display: flex;
        }

        .sidebar {
          z-index: 100;
        }

        .topbar {
          padding: var(--spacing-md);
        }

        .topbar-title {
          font-size: 1.125rem;
        }

        .user-name {
          display: none;
        }

        .main-area {
          padding: var(--spacing-md);
        }
      }

      @media (max-width: 640px) {
        .topbar-right {
          gap: var(--spacing-sm);
        }

        .theme-toggle, .user-avatar {
          width: 40px;
          height: 40px;
        }

        .nav-link {
          padding: var(--spacing-md);
          font-size: 0.875rem;
        }

        .nav-link i {
          margin-right: var(--spacing-sm);
        }

        .card-body {
          padding: var(--spacing-md);
        }

        .btn {
          padding: var(--spacing-sm) var(--spacing-md);
          font-size: 0.8125rem;
        }
      }

      /* ===== Animations ===== */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in-up {
        animation: fadeInUp 0.5s ease-out;
      }

      /* ===== Print Styles ===== */
      @media print {
        .sidebar, .topbar, .theme-toggle, .mobile-menu-btn {
          display: none !important;
        }

        .main-content {
          margin-left: 0 !important;
        }

        .card {
          box-shadow: none !important;
          border: 1px solid #ddd !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h4>
          <i class="bi bi-building me-2"></i>
          Admin Panel
        </h4>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-item">
          <a href="{{ url_for('dashboard') }}" class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}">
            <i class="bi bi-speedometer2"></i>
            Dashboard
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('panel') }}" class="nav-link {% if request.endpoint == 'panel' %}active{% endif %}">
            <i class="bi bi-megaphone"></i>
            Cargar Avisos
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('historial_push') }}" class="nav-link {% if request.endpoint == 'historial_push' %}active{% endif %}">
            <i class="bi bi-bell"></i>
            Historial Push
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('listar_choferes') }}" class="nav-link {% if request.endpoint == 'listar_choferes' %}active{% endif %}">
            <i class="bi bi-people"></i>
            Empleados
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('vista_kpis') }}" class="nav-link {% if request.endpoint == 'vista_kpis' %}active{% endif %}">
            <i class="bi bi-bar-chart"></i>
            KPIs Acumulados
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('vista_kpis1') }}" class="nav-link {% if request.endpoint == 'vista_kpis1' %}active{% endif %}">
            <i class="bi bi-graph-up"></i>
            KPIs por Fechas
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('subida_resultados') }}" class="nav-link {% if request.endpoint == 'subida_resultados' %}active{% endif %}">
            <i class="bi bi-upload"></i>
            Subida Resultados
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('admin_indicadores') }}" class="nav-link {% if request.path.startswith('/admin/indicadores') %}active{% endif %}">
            <i class="bi bi-sliders"></i>
            Indicadores
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('ver_vales') }}" class="nav-link {% if request.endpoint == 'ver_vales' %}active{% endif %}">
            <i class="bi bi-cash-stack"></i>
            Vales
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('admin_pedidos') }}" class="nav-link {% if request.path.startswith('/dashboard/pedidos') %}active{% endif %}">
            <i class="bi bi-box-seam"></i>
            Pedidos
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('admin_reuniones') }}" class="nav-link {% if request.path.startswith('/dashboard/Crud') %}active{% endif %}">
            <i class="bi bi-calendar-event"></i>
            Reuniones
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('asignaciones_global') }}" class="nav-link {% if request.path.startswith('/admin/asignaciones') %}active{% endif %}">
            <i class="bi bi-people-fill"></i>
            Asignaciones
          </a>
        </div>

        <!-- Mantenimiento Section -->
        <div class="nav-item mt-3">
          <div class="px-3 py-2 text-muted fw-bold text-uppercase" style="font-size: 0.75rem; letter-spacing: 0.5px;">
            Mantenimiento
          </div>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('admin_proveedores') }}" class="nav-link {% if request.endpoint == 'admin_proveedores' %}active{% endif %}">
            <i class="bi bi-building"></i>
            Proveedores
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('admin_rubros') }}" class="nav-link {% if request.endpoint == 'admin_rubros' %}active{% endif %}">
            <i class="bi bi-tags"></i>
            Rubros
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('admin_ordenes') }}" class="nav-link {% if request.endpoint == 'admin_ordenes' %}active{% endif %}">
            <i class="bi bi-tools"></i>
            Órdenes Servicio
          </a>
        </div>

        <div class="nav-item">
          <a href="{{ url_for('admin_gastos') }}" class="nav-link {% if request.endpoint == 'admin_gastos' %}active{% endif %}">
            <i class="bi bi-cash"></i>
            Gastos
          </a>
        </div>

        <div class="nav-item mt-auto">
          <a href="{{ url_for('logout') }}" class="nav-link text-danger">
            <i class="bi bi-box-arrow-right"></i>
            Cerrar Sesión
          </a>
        </div>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Topbar -->
      <div class="topbar">
        <div class="topbar-left">
          <button class="mobile-menu-btn" onclick="toggleSidebar()" aria-label="Abrir menú">
            <i class="bi bi-list"></i>
          </button>
          <h5 class="topbar-title">{% block header %}Panel{% endblock %}</h5>
        </div>

        <div class="topbar-right">
          <button class="theme-toggle" onclick="toggleTheme()" aria-label="Cambiar tema">
            <i class="bi bi-sun-fill" id="theme-icon"></i>
          </button>

          <div class="user-info">
            <div class="user-avatar">
              {{ session.get('admin', 'A')[0].upper() }}
            </div>
            <span class="user-name">{{ session.get('admin', 'Admin') }}</span>
          </div>
        </div>
      </div>

      <!-- Main Area -->
      <div class="main-area">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show fade-in-up" role="alert">
          {% if category == 'success' %}
          <i class="bi bi-check-circle-fill"></i>
          {% elif category == 'danger' %}
          <i class="bi bi-exclamation-triangle-fill"></i>
          {% elif category == 'warning' %}
          <i class="bi bi-exclamation-circle-fill"></i>
          {% elif category == 'info' %}
          <i class="bi bi-info-circle-fill"></i>
          {% endif %}
          <div>{{ message }}</div>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Page Content -->
        {% block content %}{% endblock %}
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

    <!-- Custom JavaScript -->
    <script>
      // Theme Management
      class ThemeManager {
        constructor() {
          this.storageKey = "admin-panel-theme";
          this.init();
        }

        init() {
          const savedTheme = this.getSavedTheme();
          const systemTheme = this.getSystemTheme();
          const theme = savedTheme || systemTheme;

          this.setTheme(theme);
          this.updateIcon(theme);

          // Listen for system theme changes
          window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
            if (!this.getSavedTheme()) {
              this.setTheme(e.matches ? "dark" : "light");
              this.updateIcon(e.matches ? "dark" : "light");
            }
          });
        }

        getSavedTheme() {
          try {
            return localStorage.getItem(this.storageKey);
          } catch (e) {
            return null;
          }
        }

        getSystemTheme() {
          return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        }

        setTheme(theme) {
          document.documentElement.setAttribute("data-theme", theme);
          try {
            localStorage.setItem(this.storageKey, theme);
          } catch (e) {
            console.warn("Could not save theme preference");
          }
        }

        updateIcon(theme) {
          const themeIcon = document.getElementById("theme-icon");
          if (themeIcon) {
            themeIcon.className = theme === "dark" ? "bi bi-moon-stars-fill" : "bi bi-sun-fill";
          }
        }

        toggle() {
          const currentTheme = document.documentElement.getAttribute("data-theme");
          const newTheme = currentTheme === "dark" ? "light" : "dark";

          this.setTheme(newTheme);
          this.updateIcon(newTheme);

          // Smooth transition
          document.body.style.transition = "background 0.3s ease";
          setTimeout(() => {
            document.body.style.transition = "";
          }, 300);
        }
      }

      // Sidebar Management
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebar-overlay");

        sidebar.classList.toggle("open");
        overlay.classList.toggle("active");

        // Prevent body scroll when sidebar is open
        document.body.style.overflow = sidebar.classList.contains("open") ? "hidden" : "";
      }

      // Close sidebar when clicking overlay
      document.getElementById("sidebar-overlay").addEventListener("click", toggleSidebar);

      // Close sidebar on mobile when clicking nav links
      document.addEventListener("DOMContentLoaded", function() {
        const navLinks = document.querySelectorAll(".nav-link");
        navLinks.forEach(link => {
          link.addEventListener("click", function() {
            if (window.innerWidth <= 1023) {
              toggleSidebar();
            }
          });
        });
      });

      // Handle window resize
      window.addEventListener("resize", function() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebar-overlay");

        if (window.innerWidth > 1023) {
          sidebar.classList.remove("open");
          overlay.classList.remove("active");
          document.body.style.overflow = "";
        }
      });

      // Close sidebar with ESC key
      document.addEventListener("keydown", function(e) {
        if (e.key === "Escape") {
          const sidebar = document.getElementById("sidebar");
          if (sidebar.classList.contains("open")) {
            toggleSidebar();
          }
        }
      });

      // Initialize theme manager
      let themeManager;
      function toggleTheme() {
        if (themeManager) {
          themeManager.toggle();
        }
      }

      document.addEventListener("DOMContentLoaded", function() {
        themeManager = new ThemeManager();

        // Auto-dismiss alerts after 5 seconds
        setTimeout(() => {
          document.querySelectorAll(".alert").forEach(alert => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          });
        }, 5000);
      });
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
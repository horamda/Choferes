{% extends "base.html" %}
{% block title %}Nuevo Proveedor{% endblock %}
{% block header %}➕ Nuevo Proveedor{% endblock %}

{% block content %}
<div class="container py-3">
  
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb bg-transparent p-0 mb-0">
      <li class="breadcrumb-item">
        <a href="{{ url_for('admin_proveedores') }}" class="text-decoration-none">
          <i class="bi bi-building me-1"></i>Proveedores
        </a>
      </li>
      <li class="breadcrumb-item active">Nuevo Proveedor</li>
    </ol>
  </nav>

  <div class="row justify-content-center">
    <div class="col-12 col-lg-8 col-xl-6">
      
      <!-- Header del formulario -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body text-center py-4">
          <div class="mb-3">
            <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" 
                 style="width: 60px; height: 60px;">
              <i class="bi bi-person-plus-fill text-primary fs-4"></i>
            </div>
          </div>
          <h4 class="fw-bold text-primary mb-2">Agregar Nuevo Proveedor</h4>
          <p class="text-muted mb-0">Complete la información del nuevo proveedor</p>
        </div>
      </div>

      <!-- Formulario -->
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          
          <div>
            
            <!-- Información Básica -->
            <div class="mb-4">
              <h6 class="text-uppercase text-muted small fw-semibold mb-3">
                <i class="bi bi-info-circle me-2"></i>Información Básica
              </h6>
              
              <div class="row g-3">
                <div class="col-12">
                  <label for="nombre" class="form-label fw-semibold">
                    Nombre del Proveedor <span class="text-danger">*</span>
                  </label>
                  <input type="text" 
                         class="form-control form-control-lg" 
                         id="nombre" 
                         name="nombre" 
                         placeholder="Ingrese el nombre del proveedor"
                         required>
                  <div class="form-text">
                    <i class="bi bi-info-circle me-1"></i>
                    El nombre debe ser único en el sistema
                  </div>
                </div>
                
                <div class="col-md-6">
                  <label for="cuit" class="form-label fw-semibold">CUIT</label>
                  <input type="text" 
                         class="form-control" 
                         id="cuit" 
                         name="cuit" 
                         placeholder="XX-XXXXXXXX-X"
                         maxlength="13">
                  <div class="form-text">Formato: 20-12345678-9</div>
                </div>
                
                <div class="col-md-6">
                  <label for="rubro" class="form-label fw-semibold">Rubro</label>
                  <select class="form-select" id="rubro" name="rubro_id">
                    <option value="">Seleccionar rubro...</option>
                    {% for rubro in rubros %}
                    <option value="{{ rubro.id }}">{{ rubro.nombre }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>

            <!-- Información de Contacto -->
            <div class="mb-4">
              <h6 class="text-uppercase text-muted small fw-semibold mb-3">
                <i class="bi bi-telephone me-2"></i>Información de Contacto
              </h6>
              
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="telefono" class="form-label fw-semibold">Teléfono</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="bi bi-telephone"></i>
                    </span>
                    <input type="tel" 
                           class="form-control" 
                           id="telefono" 
                           name="telefono" 
                           placeholder="11-1234-5678">
                  </div>
                </div>
                
                <div class="col-md-6">
                  <label for="email" class="form-label fw-semibold">Email</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="bi bi-envelope"></i>
                    </span>
                    <input type="email" 
                           class="form-control" 
                           id="email" 
                           name="email" 
                           placeholder="proveedor@email.com">
                  </div>
                </div>
                
                <div class="col-12">
                  <label for="sitio_web" class="form-label fw-semibold">Sitio Web</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="bi bi-globe"></i>
                    </span>
                    <input type="url" 
                           class="form-control" 
                           id="sitio_web" 
                           name="sitio_web" 
                           placeholder="https://www.ejemplo.com">
                  </div>
                </div>
              </div>
            </div>

            <!-- Ubicación -->
            <div class="mb-4">
              <h6 class="text-uppercase text-muted small fw-semibold mb-3">
                <i class="bi bi-geo-alt me-2"></i>Ubicación
              </h6>
              
              <div class="row g-3">
                <div class="col-12">
                  <label for="direccion" class="form-label fw-semibold">Dirección</label>
                  <input type="text" 
                         class="form-control" 
                         id="direccion" 
                         name="direccion" 
                         placeholder="Calle, número, piso, departamento">
                </div>
                
                <div class="col-md-6">
                  <label for="localidad" class="form-label fw-semibold">Localidad</label>
                  <input type="text" 
                         class="form-control" 
                         id="localidad" 
                         name="localidad" 
                         placeholder="Ciudad o localidad">
                </div>
                
                <div class="col-md-6">
                  <label for="provincia" class="form-label fw-semibold">Provincia</label>
                  <select class="form-select" id="provincia" name="provincia">
                    <option value="">Seleccionar provincia...</option>
                    <option value="Buenos Aires">Buenos Aires</option>
                    <option value="CABA">Ciudad Autónoma de Buenos Aires</option>
                    <option value="Catamarca">Catamarca</option>
                    <option value="Chaco">Chaco</option>
                    <option value="Chubut">Chubut</option>
                    <option value="Córdoba">Córdoba</option>
                    <option value="Corrientes">Corrientes</option>
                    <option value="Entre Ríos">Entre Ríos</option>
                    <option value="Formosa">Formosa</option>
                    <option value="Jujuy">Jujuy</option>
                    <option value="La Pampa">La Pampa</option>
                    <option value="La Rioja">La Rioja</option>
                    <option value="Mendoza">Mendoza</option>
                    <option value="Misiones">Misiones</option>
                    <option value="Neuquén">Neuquén</option>
                    <option value="Río Negro">Río Negro</option>
                    <option value="Salta">Salta</option>
                    <option value="San Juan">San Juan</option>
                    <option value="San Luis">San Luis</option>
                    <option value="Santa Cruz">Santa Cruz</option>
                    <option value="Santa Fe">Santa Fe</option>
                    <option value="Santiago del Estero">Santiago del Estero</option>
                    <option value="Tierra del Fuego">Tierra del Fuego</option>
                    <option value="Tucumán">Tucumán</option>
                  </select>
                </div>
                
                <div class="col-md-6">
                  <label for="codigo_postal" class="form-label fw-semibold">Código Postal</label>
                  <input type="text" 
                         class="form-control" 
                         id="codigo_postal" 
                         name="codigo_postal" 
                         placeholder="1234">
                </div>
              </div>
            </div>

            <!-- Configuración de Servicio -->
            <div class="mb-4">
              <h6 class="text-uppercase text-muted small fw-semibold mb-3">
                <i class="bi bi-gear me-2"></i>Configuración de Servicio
              </h6>
              
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="nivel_servicio" class="form-label fw-semibold">
                    Nivel de Servicio <span id="nivel_value" class="text-primary">50%</span>
                  </label>
                  <input type="range" 
                         class="form-range" 
                         id="nivel_servicio" 
                         name="nivel_servicio" 
                         min="0" 
                         max="100" 
                         value="50">
                  <div class="d-flex justify-content-between small text-muted">
                    <span>0%</span>
                    <span>50%</span>
                    <span>100%</span>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <label for="activo" class="form-label fw-semibold">Estado</label>
                  <div class="form-check form-switch mt-2">
                    <input class="form-check-input" 
                           type="checkbox" 
                           id="activo" 
                           name="activo" 
                           checked>
                    <label class="form-check-label fw-semibold" for="activo">
                      Proveedor Activo
                    </label>
                  </div>
                  <div class="form-text">
                    Los proveedores inactivos no aparecen en las búsquedas
                  </div>
                </div>
              </div>
            </div>

            <!-- Observaciones -->
            <div class="mb-4">
              <label for="observaciones" class="form-label fw-semibold">
                <i class="bi bi-chat-text me-2"></i>Observaciones
              </label>
              <textarea class="form-control" 
                        id="observaciones" 
                        name="observaciones" 
                        rows="4" 
                        placeholder="Información adicional, condiciones especiales, notas importantes..."></textarea>
              <div class="form-text">
                <span id="char_count">0</span>/500 caracteres
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="row g-2">
              <div class="col-12 col-md-6 order-md-2">
                <button type="submit" class="btn btn-primary btn-lg w-100">
                  <i class="bi bi-check-circle me-2"></i>Crear Proveedor
                </button>
              </div>
              <div class="col-12 col-md-6 order-md-1">
                <a href="{{ url_for('admin_proveedores') }}" 
                   class="btn btn-outline-secondary btn-lg w-100">
                  <i class="bi bi-arrow-left me-2"></i>Cancelar
                </a>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Actualizar valor del nivel de servicio
    const nivelServicio = document.getElementById('nivel_servicio');
    const nivelValue = document.getElementById('nivel_value');
    
    nivelServicio.addEventListener('input', function() {
        nivelValue.textContent = this.value + '%';
        nivelValue.className = 'text-' + (this.value >= 80 ? 'success' : this.value >= 50 ? 'warning' : 'danger');
    });
    
    // Contador de caracteres para observaciones
    const observaciones = document.getElementById('observaciones');
    const charCount = document.getElementById('char_count');
    
    observaciones.addEventListener('input', function() {
        const count = this.value.length;
        charCount.textContent = count;
        charCount.className = count > 450 ? 'text-warning' : count > 480 ? 'text-danger' : 'text-muted';
    });
    
    // Validación de CUIT en tiempo real
    const cuitInput = document.getElementById('cuit');
    cuitInput.addEventListener('input', function() {
        let value = this.value.replace(/\D/g, '');
        if (value.length >= 2) value = value.substring(0,2) + '-' + value.substring(2);
        if (value.length >= 11) value = value.substring(0,11) + '-' + value.substring(11);
        if (value.length > 13) value = value.substring(0,13);
        this.value = value;
    });
    
    // Validación del formulario
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const nombre = document.getElementById('nombre').value.trim();
            if (!nombre) {
                e.preventDefault();
                alert('El nombre del proveedor es requerido');
                document.getElementById('nombre').focus();
                return;
            }
            
            // Confirmación antes de enviar
            if (!confirm('¿Está seguro de que desea crear este proveedor?')) {
                e.preventDefault();
            }
        });
    }
    
    // Auto-focus en el primer campo
    document.getElementById('nombre').focus();
});
</script>

<style>
.form-control:focus,
.form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
}

.form-range:focus::-webkit-slider-thumb {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.input-group-text {
    background-color: #f8f9fa;
    border-color: #dee2e6;
}

.card {
    border-radius: 12px;
}

.btn-lg {
    border-radius: 8px;
    font-weight: 500;
}

@media (max-width: 768px) {
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    .card-body {
        padding: 1.5rem !important;
    }
}

.breadcrumb-item + .breadcrumb-item::before {
    content: "›";
    color: #6c757d;
}

.form-text {
    font-size: 0.8rem;
}

.text-uppercase {
    letter-spacing: 0.5px;
}
</style>
{% endblock %}

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Panel Administrativo - Sistema de Gestión de Choferes">
    <meta name="author" content="Sistema de Administración">

    <title>{% block title %}Panel Administrativo{% endblock %}</title>

    <!-- Performance Optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

    <!-- Critical CSS - Bootstrap 5 + Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Fonts - Optimized Loading -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
      /* ========== CSS VARIABLES ========== */
      :root {
        /* Core Colors */
        --primary-color: #2563eb;
        --secondary-color: #1e40af;
        --accent-color: #3b82f6;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        
        /* Transitions & Effects */
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --card-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
        
        /* Light Theme */
        --bg-primary: #f8fafc;
        --bg-secondary: #e2e8f0;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --card-bg: #ffffff;
        --border-color: #e2e8f0;
        --sidebar-bg: #ffffff;
        --sidebar-color: #1e293b;
        --sidebar-hover: #f1f5f9;
        --topbar-bg: rgba(255, 255, 255, 0.95);
        --input-bg: #ffffff;
        --input-border: #ced4da;
      }

      [data-theme="dark"] {
        /* Dark Theme */
        --primary-color: #60a5fa;
        --secondary-color: #3b82f6;
        --accent-color: #60a5fa;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        
        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        --card-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.4);
        
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --card-bg: #1e293b;
        --border-color: #334155;
        --sidebar-bg: #0f172a;
        --sidebar-color: #f1f5f9;
        --sidebar-hover: #1e293b;
        --topbar-bg: rgba(30, 41, 59, 0.95);
        --input-bg: #2b3035;
        --input-border: #495057;
      }

      /* ========== GLOBAL STYLES ========== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        min-height: 100vh;
        display: flex;
        color: var(--text-primary);
        transition: var(--transition);
        overflow-x: hidden;
      }

      /* ========== SIDEBAR STYLES ========== */
      .sidebar {
        width: 280px;
        background: var(--sidebar-bg);
        color: var(--sidebar-color);
        flex-shrink: 0;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .sidebar-header {
        padding: 24px 20px;
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        border-bottom: 1px solid var(--border-color);
        position: relative;
      }

      .sidebar-header h4 {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        margin: 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .sidebar-nav {
        padding: 20px 0;
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      .nav-item {
        margin: 0 12px 8px 12px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: 14px 16px;
        color: var(--text-secondary);
        text-decoration: none;
        border-radius: 12px;
        transition: var(--transition);
        position: relative;
        font-weight: 500;
        overflow: hidden;
      }

      .nav-link::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 0;
        background: var(--accent-color);
        transition: var(--transition);
        border-radius: 0 12px 12px 0;
      }

      .nav-link:hover {
        background: var(--sidebar-hover);
        color: var(--text-primary);
        transform: translateX(4px);
      }

      .nav-link:hover::before {
        width: 4px;
      }

      .nav-link.active {
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: white;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }

      .nav-link i {
        margin-right: 12px;
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
        flex-shrink: 0;
      }

      /* ========== CONTENT AREA ========== */
      .content {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        width: 100%;
      }

      .topbar {
        background: var(--topbar-bg);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 16px 24px;
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 100;
        transition: var(--transition);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .topbar h5 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .theme-toggle {
        background: var(--card-bg);
        border: 2px solid var(--border-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
        color: var(--text-primary);
        margin-right: 12px;
      }

      .theme-toggle:hover {
        background: var(--accent-color);
        color: white;
        border-color: var(--accent-color);
        transform: scale(1.05);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .main {
        padding: 24px;
        flex-grow: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* ========== CARD COMPONENTS ========== */
      .card {
        border: 1px solid var(--border-color);
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        transition: var(--transition);
        background: var(--card-bg);
        overflow: hidden;
        color: var(--text-primary);
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: var(--card-shadow-hover);
      }

      .card-header {
        background: var(--card-bg);
        border-bottom: 1px solid var(--border-color);
        color: var(--text-primary);
      }

      .card-body {
        color: var(--text-primary);
      }

      .employee-card {
        position: relative;
        height: 100%;
      }

      .employee-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
      }

      .employee-image {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--border-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .sector-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: var(--accent-color);
        color: white;
      }

      .avatar-container {
        width: 120px;
        height: 120px;
        margin: 0 auto 1rem;
        border-radius: 50%;
        overflow: hidden;
        border: 3px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--card-bg);
      }

      .avatar-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .avatar-fallback {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--border-color);
        color: var(--text-secondary);
        font-size: 2.5rem;
      }

      /* ========== BUTTON COMPONENTS ========== */
      .btn-modern {
        padding: 10px 20px;
        border-radius: 10px;
        font-weight: 600;
        transition: var(--transition);
        border: none;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
      }

      .btn-modern::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: var(--transition);
      }

      .btn-modern:hover::before {
        left: 100%;
      }

      .btn-modern:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-primary-modern {
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: white;
      }

      .btn-success-modern,
      .btn-success-custom {
        background: linear-gradient(135deg, var(--success-color), #059669);
        color: white;
        border-color: var(--success-color);
      }

      .btn-warning-modern,
      .btn-warning-custom {
        background: linear-gradient(135deg, var(--warning-color), #d97706);
        color: white;
        border-color: var(--warning-color);
      }

      .btn-danger-modern,
      .btn-danger-custom {
        background: linear-gradient(135deg, var(--danger-color), #dc2626);
        color: white;
        border-color: var(--danger-color);
      }

      .btn-success-custom:hover,
      .btn-warning-custom:hover,
      .btn-danger-custom:hover {
        filter: brightness(0.9);
        transform: translateY(-1px);
      }

      /* ========== FORM COMPONENTS ========== */
      .form-control,
      .form-select {
        border-radius: 10px;
        border: 1px solid var(--input-border);
        padding: 12px 16px;
        transition: var(--transition);
        background: var(--input-bg);
        color: var(--text-primary);
        font-size: 0.95rem;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        background: var(--input-bg);
        color: var(--text-primary);
        outline: none;
      }

      .form-control::placeholder {
        color: var(--text-secondary);
        opacity: 0.7;
      }

      .form-label {
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .input-group-text {
        background-color: var(--input-bg);
        color: var(--text-secondary);
        border-color: var(--input-border);
        border-radius: 10px;
      }

      /* ========== ANIMATIONS ========== */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes pulse {
        0%, 100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .fade-in-up {
        animation: fadeInUp 0.6s ease-out;
      }

      .slide-in-right {
        animation: slideInRight 0.4s ease-out;
      }

      /* ========== ALERT COMPONENTS ========== */
      .alert {
        border: none;
        border-radius: 12px;
        padding: 16px 20px;
        margin-bottom: 20px;
        border-left: 4px solid;
        display: flex;
        align-items: center;
        box-shadow: var(--card-shadow);
      }

      .alert i {
        margin-right: 8px;
        font-size: 1.1rem;
      }

      .alert-success {
        background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        border-left-color: var(--success-color);
        color: #065f46;
      }

      .alert-danger {
        background: linear-gradient(135deg, #fef2f2, #fecaca);
        border-left-color: var(--danger-color);
        color: #991b1b;
      }

      .alert-warning {
        background: linear-gradient(135deg, #fffbeb, #fef3c7);
        border-left-color: var(--warning-color);
        color: #92400e;
      }

      .alert-info {
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        border-left-color: var(--accent-color);
        color: #1e40af;
      }

      [data-theme="dark"] .alert-success {
        background: linear-gradient(135deg, #064e3b, #065f46);
        color: #a7f3d0;
      }

      [data-theme="dark"] .alert-danger {
        background: linear-gradient(135deg, #7f1d1d, #991b1b);
        color: #fca5a5;
      }

      [data-theme="dark"] .alert-warning {
        background: linear-gradient(135deg, #78350f, #92400e);
        color: #fcd34d;
      }

      [data-theme="dark"] .alert-info {
        background: linear-gradient(135deg, #1e3a8a, #1e40af);
        color: #93c5fd;
      }

      /* ========== LOADING STATES ========== */
      .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
      }

      .loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid var(--accent-color);
        border-top: 2px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .spinner-border-sm {
        width: 1rem;
        height: 1rem;
      }

      /* ========== RESPONSIVE DESIGN ========== */
      
      /* Mobile Menu Toggle */
      .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: var(--transition);
      }

      .mobile-menu-toggle:hover {
        background: var(--sidebar-hover);
      }

      /* Sidebar Overlay */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        z-index: 1040;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      /* Mobile Styles */
      @media (max-width: 768px) {
        .mobile-menu-toggle {
          display: block;
        }

        .sidebar {
          position: fixed;
          top: 0;
          left: 0;
          bottom: 0;
          width: 280px;
          z-index: 1050;
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          display: flex;
          flex-direction: column;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .content {
          margin-left: 0;
          width: 100%;
        }

        .topbar {
          padding: 12px 16px;
        }

        .topbar h5 {
          font-size: 1.25rem;
        }

        .user-info {
          gap: 8px;
        }

        .user-info span {
          display: none;
        }

        .theme-toggle,
        .user-avatar {
          width: 36px;
          height: 36px;
        }

        .theme-toggle {
          margin-right: 8px;
        }

        .main {
          padding: 16px;
        }

        .nav-link {
          padding: 12px 16px;
        }

        .nav-link i {
          margin-right: 10px;
        }

        .card {
          margin-bottom: 16px;
        }

        .btn-modern {
          padding: 10px 16px;
          font-size: 0.875rem;
        }

        .form-control,
        .form-select {
          padding: 10px 14px;
        }

        .alert {
          padding: 12px 16px;
          margin-bottom: 16px;
        }

        .avatar-container {
          width: 100px;
          height: 100px;
        }

        /* Floating Action Button for Mobile */
        #newBtn {
          position: fixed;
          bottom: 1.5rem;
          right: 1.5rem;
          width: 56px;
          height: 56px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .btn-sm span {
          display: none;
        }

        .btn-sm i {
          margin-right: 0 !important;
        }
      }

      /* Small Mobile Styles */
      @media (max-width: 480px) {
        .sidebar {
          width: 260px;
        }

        .topbar h5 {
          font-size: 1.125rem;
        }

        .main {
          padding: 12px;
        }

        .nav-link {
          padding: 10px 14px;
          font-size: 0.875rem;
        }

        .sidebar-header {
          padding: 20px 16px;
        }

        .sidebar-header h4 {
          font-size: 1.25rem;
        }

        .btn-modern {
          padding: 8px 12px;
          font-size: 0.8rem;
        }

        .form-control,
        .form-select {
          padding: 8px 12px;
          font-size: 0.875rem;
        }

        .card {
          border-radius: 12px;
        }
      }

      /* Tablet Styles */
      @media (min-width: 769px) {
        .sidebar {
          position: static;
          transform: none !important;
          width: 280px;
          height: auto;
          display: block;
        }

        .mobile-menu-toggle,
        .sidebar-overlay {
          display: none;
        }

        .content {
          margin-left: 0;
        }

        #newBtn {
          position: static;
          width: auto;
          height: auto;
          border-radius: 10px;
          box-shadow: none;
        }

        .btn-sm span {
          display: inline;
        }
      }

      /* Large Screens */
      @media (min-width: 1200px) {
        .sidebar {
          width: 300px;
        }

        .main {
          padding: 32px;
        }

        .topbar {
          padding: 20px 32px;
        }
      }

      /* Extra Large Screens */
      @media (min-width: 1400px) {
        .sidebar {
          width: 320px;
        }

        .main {
          padding: 40px;
        }
      }

      /* Landscape Tablets */
      @media (max-width: 1024px) and (orientation: landscape) {
        .sidebar {
          width: 240px;
        }

        .nav-link {
          padding: 8px 12px;
          font-size: 0.875rem;
        }

        .nav-link i {
          margin-right: 8px;
        }
      }

      /* High DPI Screens */
      @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        .card {
          border-radius: 16px;
        }

        .btn-modern {
          border-radius: 10px;
        }
      }

      /* Print Styles */
      @media print {
        .sidebar,
        .topbar,
        .theme-toggle,
        .mobile-menu-toggle,
        .sidebar-overlay {
          display: none !important;
        }

        .content {
          margin-left: 0;
          width: 100%;
        }

        .main {
          padding: 0;
        }

        .card {
          box-shadow: none;
          border: 1px solid #ddd;
          break-inside: avoid;
        }

        body {
          background: white !important;
          color: black !important;
        }
      }

      /* ========== SECTOR ICONS ========== */
      .sector-icon {
        font-size: 1.2em;
        margin-right: 5px;
      }

      /* ========== ACCESSIBILITY IMPROVEMENTS ========== */
      .visually-hidden-focusable {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
      }

      .visually-hidden-focusable:focus {
        position: static !important;
        width: auto !important;
        height: auto !important;
        padding: 0.5rem 1rem !important;
        margin: 0 !important;
        overflow: visible !important;
        clip: auto !important;
        white-space: normal !important;
        background: var(--accent-color) !important;
        color: white !important;
        text-decoration: none !important;
        border-radius: 4px !important;
        z-index: 9999 !important;
      }

      /* Focus indicators */
      .nav-link:focus,
      .btn-modern:focus,
      .theme-toggle:focus,
      .mobile-menu-toggle:focus,
      .form-control:focus,
      .form-select:focus {
        outline: 2px solid var(--accent-color);
        outline-offset: 2px;
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        .card {
          border: 2px solid var(--text-primary);
        }
        
        .nav-link {
          border: 1px solid transparent;
        }
        
        .nav-link:hover,
        .nav-link:focus {
          border-color: var(--text-primary);
        }
      }

      /* Dark mode preference detection */
      @media (prefers-color-scheme: dark) {
        :root:not([data-theme]) {
          --bg-primary: #0f172a;
          --bg-secondary: #1e293b;
          --text-primary: #f1f5f9;
          --text-secondary: #cbd5e1;
          --card-bg: #1e293b;
          --border-color: #334155;
          --sidebar-bg: #0f172a;
          --sidebar-color: #f1f5f9;
          --sidebar-hover: #1e293b;
          --topbar-bg: rgba(30, 41, 59, 0.95);
          --input-bg: #2b3035;
          --input-border: #495057;
        }
      }

      /* Performance optimizations */
      .sidebar,
      .content,
      .card {
        will-change: transform;
      }

      .sidebar.active {
        will-change: auto;
      }

      /* Smooth scrolling for supported browsers */
      @supports (scroll-behavior: smooth) {
        html {
          scroll-behavior: smooth;
        }
      }
    </style>
  </head>
  <body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="visually-hidden-focusable">Saltar al contenido principal</a>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay" aria-hidden="true"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Navegación principal">
      <div class="sidebar-header">
        <h4>💼 Admin Panel</h4>
      </div>

      <nav class="sidebar-nav" role="menubar">
        <div class="nav-item" role="none">
          <a
            href="{{ url_for('dashboard') }}"
            class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'dashboard' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-speedometer2" aria-hidden="true"></i>
            Dashboard
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('panel') }}"
            class="nav-link {% if request.endpoint == 'panel' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'panel' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-megaphone" aria-hidden="true"></i>
            Cargar Avisos
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('historial_push') }}"
            class="nav-link {% if request.endpoint == 'historial_push' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'historial_push' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-bell-fill" aria-hidden="true"></i>
            Historial Push
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('listar_choferes') }}"
            class="nav-link {% if request.endpoint == 'listar_choferes' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'listar_choferes' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-people" aria-hidden="true"></i>
            Empleados
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('vista_kpis') }}"
            class="nav-link {% if request.endpoint == 'vista_kpis' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'vista_kpis' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-bar-chart-line" aria-hidden="true"></i>
            KPIs Acumulados
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('vista_kpis1') }}"
            class="nav-link {% if request.endpoint == 'vista_kpis1' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'vista_kpis1' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-graph-up" aria-hidden="true"></i>
            KPIs por Fechas
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('subida_resultados') }}"
            class="nav-link {% if request.endpoint == 'subida_resultados' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'subida_resultados' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-upload" aria-hidden="true"></i>
            Subida Resultados
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('admin_indicadores') }}"
            class="nav-link {% if request.path.startswith('/admin/indicadores') %}active{% endif %}"
            role="menuitem"
            {% if request.path.startswith('/admin/indicadores') %}aria-current="page"{% endif %}
          >
            <i class="bi bi-sliders" aria-hidden="true"></i>
            Indicadores
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('ver_vales') }}"
            class="nav-link {% if request.endpoint == 'ver_vales' %}active{% endif %}"
            role="menuitem"
            {% if request.endpoint == 'ver_vales' %}aria-current="page"{% endif %}
          >
            <i class="bi bi-cash-stack" aria-hidden="true"></i>
            Vales
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('admin_pedidos') }}"
            class="nav-link {% if request.path.startswith('/dashboard/pedidos') %}active{% endif %}"
            role="menuitem"
            {% if request.path.startswith('/dashboard/pedidos') %}aria-current="page"{% endif %}
          >
            <i class="bi bi-box-seam" aria-hidden="true"></i>
            Pedidos
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('admin_reuniones') }}"
            class="nav-link {% if request.path.startswith('/dashboard/Crud') %}active{% endif %}"
            role="menuitem"
            {% if request.path.startswith('/dashboard/Crud') %}aria-current="page"{% endif %}
          >
            <i class="bi bi-calendar-event" aria-hidden="true"></i>
            Reuniones
          </a>
        </div>

        <div class="nav-item" role="none">
          <a
            href="{{ url_for('asignaciones_global') }}"
            class="nav-link {% if request.path.startswith('/admin/asignaciones') %}active{% endif %}"
            role="menuitem"
            {% if request.path.startswith('/admin/asignaciones') %}aria-current="page"{% endif %}
          >
            <i class="bi bi-people-fill" aria-hidden="true"></i>
            Asignaciones
          </a>
        </div>
  
        <!-- Expandible Maintenance Section -->
        <div class="nav-item" role="none">
          <button class="nav-link d-flex justify-content-between align-items-center w-100 border-0 bg-transparent"
                  data-bs-toggle="collapse"
                  data-bs-target="#submenuMantenimiento"
                  aria-expanded="false"
                  aria-controls="submenuMantenimiento"
                  role="menuitem"
                  aria-haspopup="true">
            <span><i class="bi bi-building-gear" aria-hidden="true"></i> Mantenimiento</span>
            <i class="bi bi-caret-down-fill" aria-hidden="true"></i>
          </button>
          <div class="collapse" id="submenuMantenimiento">
            <div class="btn-toggle-nav ms-3" role="menu">
              <a class="nav-link {% if request.endpoint == 'admin_proveedores' %}active{% endif %}"
                 href="{{ url_for('admin_proveedores') }}"
                 role="menuitem"
                 {% if request.endpoint == 'admin_proveedores' %}aria-current="page"{% endif %}>
                <span aria-hidden="true">📦</span> Proveedores
              </a>
              <a class="nav-link {% if request.endpoint == 'admin_rubros' %}active{% endif %}"
                 href="{{ url_for('admin_rubros') }}"
                 role="menuitem"
                 {% if request.endpoint == 'admin_rubros' %}aria-current="page"{% endif %}>
                <span aria-hidden="true">🏷️</span> Rubros
              </a>
              <a class="nav-link {% if request.endpoint == 'admin_pedidos' %}active{% endif %}"
                 href="{{ url_for('admin_pedidos') }}"
                 role="menuitem"
                 {% if request.endpoint == 'admin_pedidos' %}aria-current="page"{% endif %}>
                <span aria-hidden="true">📝</span> Pedidos
              </a>
              <a class="nav-link {% if request.endpoint == 'admin_ordenes' %}active{% endif %}"
                 href="{{ url_for('admin_ordenes') }}"
                 role="menuitem"
                 {% if request.endpoint == 'admin_ordenes' %}aria-current="page"{% endif %}>
                <span aria-hidden="true">🛠️</span> Órdenes de Servicio
              </a>
              <a class="nav-link {% if request.endpoint == 'admin_gastos' %}active{% endif %}"
                 href="{{ url_for('admin_gastos') }}"
                 role="menuitem"
                 {% if request.endpoint == 'admin_gastos' %}aria-current="page"{% endif %}>
                <span aria-hidden="true">💰</span> Gastos
              </a>
            </div>
          </div>
        </div>

        <!-- System Section -->
        <div class="nav-item" style="margin-top: 20px" role="none">
          <div class="px-3 py-2 text-muted fw-bold text-uppercase" style="font-size: 0.75rem; letter-spacing: 0.5px;" role="separator">
            Sistema
          </div>
        </div>

        <div class="nav-item" role="none">
          <a href="{{ url_for('db_status') }}"
             class="nav-link {% if request.endpoint == 'db_status' %}active{% endif %}"
             role="menuitem"
             {% if request.endpoint == 'db_status' %}aria-current="page"{% endif %}>
            <i class="bi bi-database" aria-hidden="true"></i>
            Estado DB
          </a>
        </div>

        <div class="nav-item" style="margin-top: 20px" role="none">
          <a href="{{ url_for('logout') }}" class="nav-link" role="menuitem">
            <i class="bi bi-box-arrow-right" aria-hidden="true"></i>
            Cerrar Sesión
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <div class="content">
      <header class="topbar d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <button
            class="mobile-menu-toggle me-3"
            onclick="toggleSidebar()"
            aria-label="Abrir menú de navegación"
            aria-expanded="false"
            aria-controls="sidebar"
          >
            <i class="bi bi-list" aria-hidden="true"></i>
          </button>
          <h1 class="h5 mb-0">{% block header %}Panel{% endblock %}</h1>
        </div>
        <div class="user-info">
          <button
            class="theme-toggle"
            onclick="toggleTheme()"
            aria-label="Cambiar tema de color"
          >
            <i class="bi bi-sun-fill" id="theme-icon" aria-hidden="true"></i>
          </button>
          <div class="user-avatar" aria-label="Avatar del usuario">
            {{ session.get('admin', 'A')[0].upper() }}
          </div>
          <span aria-label="Nombre del usuario">{{ session.get('admin', 'Admin') }}</span>
        </div>
      </header>

      <main class="main" id="main-content" role="main">
        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="alerts-container" role="alert" aria-live="polite">
          {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show fade-in-up" role="alert">
            {% if category == 'success' %}
            <i class="bi bi-check-circle me-2" aria-hidden="true"></i>
            {% elif category == 'danger' %}
            <i class="bi bi-exclamation-triangle me-2" aria-hidden="true"></i>
            {% elif category == 'warning' %}
            <i class="bi bi-exclamation-circle me-2" aria-hidden="true"></i>
            {% elif category == 'info' %}
            <i class="bi bi-info-circle me-2" aria-hidden="true"></i>
            {% endif %}
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Cerrar alerta"
            ></button>
          </div>
          {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
      </main>
    </div>

    <!-- Bootstrap JS - Optimized Loading -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script>
      // ========== PERFORMANCE OPTIMIZATIONS ==========
      
      // Debounce function for performance
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // ========== THEME MANAGEMENT SYSTEM ==========
      class ThemeManager {
        constructor() {
          this.storageKey = "admin-panel-theme";
          this.mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
          this.init();
        }

        init() {
          const savedTheme = this.getSavedTheme();
          const systemTheme = this.getSystemTheme();
          const theme = savedTheme || systemTheme;

          this.setTheme(theme);
          this.updateIcon(theme);
          this.setupSystemThemeListener();
        }

        getSavedTheme() {
          try {
            return localStorage.getItem(this.storageKey);
          } catch (e) {
            console.warn("LocalStorage no disponible");
            return null;
          }
        }

        getSystemTheme() {
          return this.mediaQuery.matches ? "dark" : "light";
        }

        setTheme(theme) {
          document.documentElement.setAttribute("data-theme", theme);
          try {
            localStorage.setItem(this.storageKey, theme);
          } catch (e) {
            console.warn("No se pudo guardar la preferencia de tema");
          }
        }

        updateIcon(theme) {
          const themeIcon = document.getElementById("theme-icon");
          if (themeIcon) {
            themeIcon.className = theme === "dark" ? "bi bi-moon-stars-fill" : "bi bi-sun-fill";
          }
        }

        setupSystemThemeListener() {
          this.mediaQuery.addEventListener("change", (e) => {
            if (!this.getSavedTheme()) {
              const newTheme = e.matches ? "dark" : "light";
              this.setTheme(newTheme);
              this.updateIcon(newTheme);
            }
          });
        }

        toggle() {
          const currentTheme = document.documentElement.getAttribute("data-theme");
          const newTheme = currentTheme === "dark" ? "light" : "dark";
          this.setTheme(newTheme);
          this.updateIcon(newTheme);
        }
      }

      // ========== SIDEBAR MANAGEMENT ==========
      class SidebarManager {
        constructor() {
          this.sidebar = document.getElementById("sidebar");
          this.overlay = document.getElementById("sidebar-overlay");
          this.toggleBtn = document.querySelector(".mobile-menu-toggle");
          this.isOpen = false;
          this.init();
        }

        init() {
          this.setupEventListeners();
          this.setupSwipeGestures();
        }

        setupEventListeners() {
          // Toggle button
          if (this.toggleBtn) {
            this.toggleBtn.addEventListener("click", () => this.toggle());
          }

          // Overlay click
          if (this.overlay) {
            this.overlay.addEventListener("click", () => this.close());
          }

          // Navigation links (close on mobile)
          document.querySelectorAll(".nav-link").forEach(link => {
            link.addEventListener("click", () => {
              if (window.innerWidth <= 768) {
                this.close();
              }
            });
          });

          // Keyboard navigation
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && this.isOpen) {
              this.close();
            }
          });

          // Window resize
          window.addEventListener("resize", debounce(() => {
            if (window.innerWidth > 768) {
              this.close();
            }
          }, 250));
        }

        setupSwipeGestures() {
          let startX = 0;
          let startY = 0;
          let isSwipeActive = false;

          document.addEventListener("touchstart", (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isSwipeActive = true;
          }, { passive: true });

          document.addEventListener("touchmove", (e) => {
            if (!isSwipeActive) return;

            const currentX = e.touches[0].clientX;
            const currentY = e.touches[0].clientY;
            const diffX = currentX - startX;
            const diffY = currentY - startY;

            if (Math.abs(diffY) > Math.abs(diffX)) {
              isSwipeActive = false;
              return;
            }

            if (Math.abs(diffX) > 30) {
              e.preventDefault();
            }
          }, { passive: false });

          document.addEventListener("touchend", (e) => {
            if (!isSwipeActive) return;

            const endX = e.changedTouches[0].clientX;
            const diffX = endX - startX;

            if (startX < 50 && diffX > 80 && !this.isOpen) {
              this.open();
            } else if (diffX < -80 && this.isOpen) {
              this.close();
            }

            isSwipeActive = false;
          }, { passive: true });
        }

        toggle() {
          this.isOpen ? this.close() : this.open();
        }

        open() {
          this.sidebar?.classList.add("active");
          this.overlay?.classList.add("active");
          this.toggleBtn?.setAttribute("aria-expanded", "true");
          document.body.style.overflow = "hidden";
          this.isOpen = true;
        }

        close() {
          this.sidebar?.classList.remove("active");
          this.overlay?.classList.remove("active");
          this.toggleBtn?.setAttribute("aria-expanded", "false");
          document.body.style.overflow = "";
          this.isOpen = false;
        }
      }

      // ========== FORM ENHANCEMENTS ==========
      class FormManager {
        constructor() {
          this.init();
        }

        init() {
          this.setupValidation();
          this.setupLoadingStates();
        }

        setupValidation() {
          const forms = document.querySelectorAll(".needs-validation");
          forms.forEach(form => {
            form.addEventListener("submit", (event) => {
              if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add("was-validated");
            }, false);
          });
        }

        setupLoadingStates() {
          document.querySelectorAll(".btn-modern").forEach(btn => {
            btn.addEventListener("click", function() {
              if (this.type === "submit" && !this.disabled) {
                const originalText = this.innerHTML;
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>Cargando...';
                this.disabled = true;

                setTimeout(() => {
                  this.innerHTML = originalText;
                  this.disabled = false;
                }, 2000);
              }
            });
          });
        }
      }

      // ========== ALERT MANAGER ==========
      class AlertManager {
        constructor() {
          this.init();
        }

        init() {
          // Auto-dismiss alerts after 5 seconds
          setTimeout(() => {
            document.querySelectorAll(".alert").forEach(alert => {
              if (window.bootstrap?.Alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
              }
            });
          }, 5000);
        }
      }

      // ========== INITIALIZATION ==========
      let themeManager, sidebarManager, formManager, alertManager;

      // Global functions for compatibility
      function toggleTheme() {
        themeManager?.toggle();
      }

      function toggleSidebar() {
        sidebarManager?.toggle();
      }

      function setLightMode() {
        themeManager?.setTheme("light");
        themeManager?.updateIcon("light");
      }

      function setDarkMode() {
        themeManager?.setTheme("dark");
        themeManager?.updateIcon("dark");
      }

      // Initialize when DOM is ready
      document.addEventListener("DOMContentLoaded", function() {
        themeManager = new ThemeManager();
        sidebarManager = new SidebarManager();
        formManager = new FormManager();
        alertManager = new AlertManager();
      });

      // Performance monitoring (optional)
      if ('performance' in window) {
        window.addEventListener('load', () => {
          const perfData = performance.getEntriesByType('navigation')[0];
          console.log(`Page load time: ${perfData.loadEventEnd - perfData.loadEventStart}ms`);
        });
      }
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
